<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | Adi Sonaton TV</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        :root {
            --primary: #3b82f6;
            --success: #10b981;
            --danger: #ef4444;
            --dark: #1e293b;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Hind Siliguri', sans-serif; }
        body { background-color: #f1f5f9; display: flex; min-height: 100vh; }

        /* Sidebar & Layout */
        .sidebar { width: 260px; background: var(--dark); color: white; padding: 25px; position: fixed; height: 100vh; }
        .main-content { margin-left: 260px; width: calc(100% - 260px); padding: 40px; }

        /* Form Styling */
        .card { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        h2 { margin-bottom: 20px; color: var(--dark); }
        
        label { display: block; margin-bottom: 8px; font-weight: 600; color: #475569; }
        input, select, textarea { 
            width: 100%; padding: 12px; margin-bottom: 20px; 
            border: 1px solid #e2e8f0; border-radius: 8px; outline: none; 
        }

        .btn-post { 
            background: var(--primary); color: white; border: none; 
            padding: 15px; border-radius: 8px; width: 100%; 
            font-size: 18px; font-weight: 700; cursor: pointer; transition: 0.3s;
        }
        .btn-post:hover { background: #2563eb; transform: translateY(-2px); }

        .btn-add { 
            background: var(--success); color: white; border: none; 
            padding: 10px 20px; border-radius: 6px; cursor: pointer; margin-bottom: 20px; 
        }

        .extra-field { 
            background: #f8fafc; border: 1px dashed #cbd5e1; 
            padding: 15px; border-radius: 8px; margin-bottom: 15px; position: relative; 
        }
    </style>
</head>
<body>

<div class="sidebar">
    <h2 style="color: var(--primary); font-size: 20px;">Adi Sonaton TV</h2>
    <p style="font-size: 12px; opacity: 0.6; margin-bottom: 30px;">Admin Management</p>
    <div style="color: #94a3b8;">Dashboard</div>
</div>

<div class="main-content">
    <div class="card">
        <h2>নিউজ আপলোড করুন</h2>
        
        <label>সংবাদের শিরোনাম</label>
        <input type="text" id="post-title" placeholder="শিরোনাম লিখুন">

        <label>ক্যাটাগরি</label>
        <select id="post-category">
            <option value="bangladesh">বাংলাদেশ</option>
            <option value="national">জাতীয়</option>
            <option value="international">আন্তর্জাতিক</option>
            <option value="sports">খেলা</option>
            <option value="entertainment">বিনোদন</option>
            <option value="theology">ধর্মতত্ব</option>
            <option value="foundation">হিন্দু ফাউন্ডেশন</option>
        </select>

        <label>মূল ছবির লিঙ্ক (URL)</label>
        <input type="text" id="post-img" placeholder="https://example.com/image.jpg">

        <label>সংবাদ বর্ণনা</label>
        <textarea id="post-body" rows="6" placeholder="বিস্তারিত লিখুন..."></textarea>

        <div id="dynamic-area"></div>
        <button class="btn-add" onclick="addMore()"><i class="fas fa-plus"></i> অতিরিক্ত ছবি ও বর্ণনা যোগ করুন</button>

        <button class="btn-post" id="submit-btn" onclick="publishNews()">সংবাদ প্রকাশ করুন</button>
    </div>
</div>

<script>
    // আপনার Supabase তথ্য
    const S_URL = 'https://vplqtnrziptqeeusdabv.supabase.co';
    const S_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZwbHF0bnJ6aXB0cWVldXNkYWJ2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEwNDU1NDIsImV4cCI6MjA4NjYyMTU0Mn0.yMs0N0dMIImliu6PscOeKh_gYlvl184AESug-LVDKok';
    const supabaseClient = supabase.createClient(S_URL, S_KEY);

    // অতিরিক্ত ফিল্ড যোগ করার ফাংশন
    function addMore() {
        const area = document.getElementById('dynamic-area');
        const div = document.createElement('div');
        div.className = 'extra-field';
        div.innerHTML = `
            <input type="text" class="ex-img" placeholder="ছবির লিঙ্ক">
            <textarea class="ex-desc" rows="2" placeholder="বর্ণনা"></textarea>
            <button onclick="this.parentElement.remove()" style="color:red; border:none; background:none; cursor:pointer;">মুছে ফেলুন</button>
        `;
        area.appendChild(div);
    }

    // সংবাদ ডাটাবেজে সেভ করার প্রধান ফাংশন
    async function publishNews() {
        const btn = document.getElementById('submit-btn');
        
        // ইনপুট ভ্যালু সংগ্রহ
        const title = document.getElementById('post-title').value;
        const category = document.getElementById('post-category').value;
        const image_url = document.getElementById('post-img').value;
        const content = document.getElementById('post-body').value;

        // ভ্যালিডেশন
        if (!title || !image_url || !content) {
            alert("অনুগ্রহ করে শিরোনাম, ছবি এবং বর্ণনা প্রদান করুন।");
            return;
        }

        // বাটন ডিজেবল করা (যাতে বারবার ক্লিক না হয়)
        btn.innerText = "প্রসেসিং...";
        btn.disabled = true;

        // অতিরিক্ত তথ্য সংগ্রহ
        const extraImgs = Array.from(document.querySelectorAll('.ex-img')).map(i => i.value);
        const extraDescs = Array.from(document.querySelectorAll('.ex-desc')).map(d => d.value);

        try {
            // ডাটাবেজ ইনসার্ট
            const { data, error } = await supabaseClient
                .from('news_portal')
                .insert([
                    { 
                        title: title, 
                        category: category, 
                        image_url: image_url, 
                        content: content,
                        extra_images: extraImgs,
                        extra_descriptions: extraDescs
                    }
                ]);

            if (error) {
                console.error("Supabase Error:", error);
                alert("ত্রুটি: " + error.message);
            } else {
                alert("অভিনন্দন! সংবাদটি সফলভাবে প্রকাশিত হয়েছে।");
                location.reload(); // পেজ রিফ্রেশ করে ফর্ম খালি করা
            }
        } catch (err) {
            alert("কানেকশন এরর! আবার চেষ্টা করুন।");
        } finally {
            btn.innerText = "সংবাদ প্রকাশ করুন";
            btn.disabled = false;
        }
    }
</script>

</body>
</html>
